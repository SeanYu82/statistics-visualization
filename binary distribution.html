<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´í•­ë¶„í¬ ì‹œë®¬ë ˆì´í„°</title>
    <style>
        :root {
            --primary: #8b5cf6;
            /* ë³´ë¼ìƒ‰ ê³„ì—´ */
            --success: #10b981;
            /* ì„±ê³µ (ì´ˆë¡) */
            --fail: #94a3b8;
            /* ì‹¤íŒ¨ (íšŒìƒ‰) */
            --bg: #f8fafc;
            --text: #1e293b;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            line-height: 1.6;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
            margin-top: 0;
            color: var(--primary);
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        canvas {
            width: 100%;
            height: 300px;
            background: #f1f5f9;
            border-radius: 8px;
            margin: 15px 0;
        }

        /* ì½”ì¸ ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ */
        #coinGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
            gap: 10px;
            margin: 20px 0;
            min-height: 100px;
        }

        .coin {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
        }

        .coin.success {
            background-color: var(--success);
            transform: scale(1.1);
        }

        .coin.fail {
            background-color: var(--fail);
            transform: scale(0.9);
            opacity: 0.6;
        }

        .controls {
            display: flex;
            gap: 20px;
            background: #f1f5f9;
            padding: 20px;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        .control-group label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .control-group input[type=range] {
            width: 100%;
            cursor: pointer;
        }

        .val-display {
            font-weight: bold;
            color: var(--primary);
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            margin-top: 10px;
            transition: background 0.2s;
        }

        button:hover {
            background: #7c3aed;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: #ede9fe;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-val {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ğŸ² ì´í•­ë¶„í¬ ì‹œë®¬ë ˆì´í„° (Binomial Distribution)</h1>
        <p style="text-align: center; color: #64748b;">
            ë² ë¥´ëˆ„ì´ ì‹œí–‰(ì„±ê³µ/ì‹¤íŒ¨)ì„ në²ˆ ë°˜ë³µí–ˆì„ ë•Œ, ì„±ê³µ íšŸìˆ˜(x)ì˜ ë¶„í¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
        </p>

        <section class="card">
            <h2>1. ë² ë¥´ëˆ„ì´ ì‹œí–‰ ì§ì ‘ í•´ë³´ê¸°</h2>
            <p>
                ì„±ê³µ í™•ë¥ ì´ <strong>p</strong>ì¸ ì‹œí–‰ì„ <strong>n</strong>ë²ˆ ë°˜ë³µí•©ë‹ˆë‹¤.<br>
                ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤ì œë¡œ ì–´ë–¤ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.
            </p>

            <div class="controls">
                <div class="control-group">
                    <label>ì‹œí–‰ íšŸìˆ˜ (n): <span id="val-n-sim" class="val-display">10</span></label>
                    <input type="range" id="range-n" min="1" max="50" value="10">
                </div>
                <div class="control-group">
                    <label>ì„±ê³µ í™•ë¥  (p): <span id="val-p-sim" class="val-display">0.5</span></label>
                    <input type="range" id="range-p" min="0.01" max="0.99" step="0.01" value="0.5">
                </div>
            </div>

            <div style="text-align: center;">
                <button onclick="runSimulation()">ğŸ² ì‹œí–‰ ì‹œì‘ (Toss!)</button>
            </div>

            <div id="coinGrid"></div>

            <div class="stats">
                <div class="stat-item">ì´ ì‹œí–‰<br><span id="res-total" class="stat-val">0</span></div>
                <div class="stat-item">ì„±ê³µ(x)<br><span id="res-success" class="stat-val"
                        style="color: var(--success)">0</span></div>
                <div class="stat-item">ì‹¤íŒ¨<br><span id="res-fail" class="stat-val" style="color: var(--fail)">0</span>
                </div>
            </div>
        </section>

        <section class="card">
            <h2>2. ì´ë¡ ì  í™•ë¥ ë¶„í¬ (ì„±ê³µ íšŸìˆ˜ì˜ ë„ìˆ˜ë¶„í¬)</h2>
            <p>
                ìœ„ì™€ ê°™ì€ ì‹œí–‰ì„ ë¬´í•œíˆ ë°˜ë³µí•œë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ, ì„±ê³µ íšŸìˆ˜ë³„ í™•ë¥ ì…ë‹ˆë‹¤.<br>
                <strong>n</strong>ì´ ì»¤ì§€ê±°ë‚˜ <strong>p</strong>ê°€ ë³€í•  ë•Œ ê·¸ë˜í”„ì˜ ëª¨ì–‘(ëŒ€ì¹­ì„±, ì ë¦¼)ì„ ê´€ì°°í•˜ì„¸ìš”.
            </p>
            <canvas id="distCanvas"></canvas>
            <p style="text-align: center; font-size: 0.9rem;">
                * íŒŒë€ ë§‰ëŒ€: ì´í•­ë¶„í¬ í™•ë¥  P(X=k)<br>
                * ë¶‰ì€ ì„ : ê·¼ì‚¬ ì •ê·œë¶„í¬ ê³¡ì„  (nì´ í´ìˆ˜ë¡ ì¼ì¹˜í•¨)
            </p>
            <div class="stats" style="background: #f1f5f9;">
                <div class="stat-item">ê¸°ëŒ€ê°’ (E = np)<br><span id="calc-mean" class="stat-val">5.0</span></div>
                <div class="stat-item">ë¶„ì‚° (V = npq)<br><span id="calc-var" class="stat-val">2.5</span></div>
            </div>
        </section>
    </div>

    <script>
        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        // íŒ©í† ë¦¬ì–¼ ì—†ì´ ì¡°í•©(nCr) ê³„ì‚° (ì•ˆì •ì„± ìœ„í•¨)
        function nCr(n, r) {
            if (r < 0 || r > n) return 0;
            if (r === 0 || r === n) return 1;
            if (r > n / 2) r = n - r;
            let res = 1;
            for (let i = 1; i <= r; i++) {
                res = res * (n - i + 1) / i;
            }
            return res;
        }

        // ì´í•­í™•ë¥  ê³„ì‚° P(X=k)
        function binomialProb(n, p, k) {
            return nCr(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
        }

        // ì •ê·œë¶„í¬ í•¨ìˆ˜ (ê·¼ì‚¬ ê³¡ì„ ìš©)
        function gaussian(x, mu, sigma) {
            return (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mu) / sigma, 2));
        }

        // --- DOM ìš”ì†Œ ë° ë³€ìˆ˜ ---
        const rangeN = document.getElementById('range-n');
        const rangeP = document.getElementById('range-p');
        const valN = document.getElementById('val-n-sim');
        const valP = document.getElementById('val-p-sim');
        const coinGrid = document.getElementById('coinGrid');

        const resTotal = document.getElementById('res-total');
        const resSuccess = document.getElementById('res-success');
        const resFail = document.getElementById('res-fail');

        const cvs = document.getElementById('distCanvas');
        const ctx = cvs.getContext('2d');

        const calcMean = document.getElementById('calc-mean');
        const calcVar = document.getElementById('calc-var');

        // --- 1. ì‹œí–‰ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ ---
        function runSimulation() {
            const n = parseInt(rangeN.value);
            const p = parseFloat(rangeP.value);

            coinGrid.innerHTML = ''; // ì´ˆê¸°í™”
            let successCount = 0;

            // ë™ì „(ì›) ìƒì„± ë° ì• ë‹ˆë©”ì´ì…˜
            for (let i = 0; i < n; i++) {
                const coin = document.createElement('div');
                coin.className = 'coin';
                coin.innerText = '?';
                coinGrid.appendChild(coin);

                // ìˆœì°¨ì  ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                setTimeout(() => {
                    const isSuccess = Math.random() < p;
                    if (isSuccess) {
                        coin.classList.add('success');
                        coin.innerText = 'O';
                        successCount++;
                    } else {
                        coin.classList.add('fail');
                        coin.innerText = 'X';
                    }

                    // ë§ˆì§€ë§‰ ì½”ì¸ì¼ ë•Œ ê²°ê³¼ ì—…ë°ì´íŠ¸
                    if (i === n - 1) {
                        resTotal.innerText = n;
                        resSuccess.innerText = successCount;
                        resFail.innerText = n - successCount;
                    }
                }, i * 50); // 0.05ì´ˆ ê°„ê²©ìœ¼ë¡œ ê²°ê³¼ ê³µê°œ
            }
        }

        // --- 2. ê·¸ë˜í”„ ê·¸ë¦¬ê¸° ë¡œì§ ---
        function drawDistribution() {
            const n = parseInt(rangeN.value);
            const p = parseFloat(rangeP.value);

            // UI ê°’ ì—…ë°ì´íŠ¸
            valN.innerText = n;
            valP.innerText = p;

            // í†µê³„ëŸ‰ ê³„ì‚°
            const mean = n * p;
            const variance = n * p * (1 - p);
            const stdDev = Math.sqrt(variance);

            calcMean.innerText = mean.toFixed(2);
            calcVar.innerText = variance.toFixed(2);

            // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
            cvs.width = cvs.offsetWidth;
            cvs.height = cvs.offsetHeight;
            const w = cvs.width;
            const h = cvs.height;
            ctx.clearRect(0, 0, w, h);

            // í™•ë¥ ê°’ ë¯¸ë¦¬ ê³„ì‚° (ìµœëŒ€ í™•ë¥ ê°’ì„ ì°¾ì•„ Yì¶• ìŠ¤ì¼€ì¼ë§ìš©)
            let probs = [];
            let maxProb = 0;
            for (let k = 0; k <= n; k++) {
                let prob = binomialProb(n, p, k);
                probs.push(prob);
                if (prob > maxProb) maxProb = prob;
            }

            // ì—¬ë°± ë° ìŠ¤ì¼€ì¼ë§
            const padding = 40;
            const graphW = w - padding * 2;
            const graphH = h - padding * 2;
            const barWidth = (graphW / (n + 1)) * 0.8;
            const stepX = graphW / (n + 1);

            // ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸° (ì´í•­ë¶„í¬)
            ctx.fillStyle = '#6366f1'; // Primary color

            for (let k = 0; k <= n; k++) {
                let prob = probs[k];
                let barH = (prob / (maxProb * 1.1)) * graphH; // 1.1ì€ ì—¬ìœ ê³µê°„

                let x = padding + k * stepX + (stepX - barWidth) / 2;
                let y = h - padding - barH;

                // ë§‰ëŒ€
                ctx.fillRect(x, y, barWidth, barH);

                // Xì¶• ë ˆì´ë¸” (ë„ˆë¬´ ë§ìœ¼ë©´ ìƒëµ)
                if (n <= 20 || k % 5 === 0) {
                    ctx.fillStyle = '#333';
                    ctx.font = '12px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(k, x + barWidth / 2, h - padding + 15);
                    ctx.fillStyle = '#6366f1'; // ë‹¤ì‹œ ë§‰ëŒ€ ìƒ‰ìœ¼ë¡œ
                }
            }

            // ì •ê·œë¶„í¬ ê·¼ì‚¬ ê³¡ì„  ê·¸ë¦¬ê¸° (Overlay)
            if (n >= 5) { // nì´ ë„ˆë¬´ ì‘ìœ¼ë©´ ê·¼ì‚¬ê°€ ì˜ë¯¸ ì—†ìŒ
                ctx.beginPath();
                ctx.strokeStyle = '#ef4444'; // ë¶‰ì€ìƒ‰
                ctx.lineWidth = 2;

                // ì—°ì†ì ì¸ ê³¡ì„ ì„ ìœ„í•´ ì´˜ì´˜í•˜ê²Œ ê·¸ë¦¼
                for (let cx = 0; cx <= n; cx += 0.1) {
                    // Xì¢Œí‘œ ë³€í™˜: ë§‰ëŒ€ì˜ ì¤‘ì‹¬ì  ê¸°ì¤€
                    let plotX = padding + cx * stepX + stepX / 2;

                    // ì •ê·œë¶„í¬ í™•ë¥ ë°€ë„í•¨ìˆ˜ ê°’
                    let pdf = gaussian(cx, mean, stdDev);

                    // Yì¢Œí‘œ ë³€í™˜: ë§‰ëŒ€ê·¸ë˜í”„ì˜ ë©´ì (=1)ê³¼ PDF ë©´ì (=1) ìŠ¤ì¼€ì¼ ë§ì¶”ê¸°
                    // ì´ì‚°í™•ë¥  P(X=k)ëŠ” ì—°ì†í™•ë¥ ë¶„í¬ì—ì„œ êµ¬ê°„ í­ì´ 1ì¼ ë•Œì˜ ë©´ì ê³¼ ìœ ì‚¬
                    // ìŠ¤ì¼€ì¼ë§ íŒ©í„° = canvasHeight / maxProb * pdf
                    // í•˜ì§€ë§Œ ì‹œê°ì  ë§¤ì¹­ì„ ìœ„í•´ maxProb ê¸°ì¤€ìœ¼ë¡œ ë§ì¶¤

                    // ê·¼ì‚¬ ë†’ì´ ê³„ì‚°: PDFê°’ì— ë¹„ë¡€í•˜ë˜, ì‹œê°ì  ë§¤ì¹­ì„ ìœ„í•´ ì¡°ì •
                    // ê°€ì¥ ë†’ì€ ì (mean)ì—ì„œì˜ PDFê°’ê³¼ ì´í•­ë¶„í¬ ìµœëŒ€í™•ë¥ ì„ ë¹„êµ ë³´ì •
                    let peakPDF = gaussian(mean, mean, stdDev);
                    let scaleRatio = maxProb / peakPDF;

                    let plotY = h - padding - (pdf * scaleRatio / (maxProb * 1.1)) * graphH;

                    if (cx === 0) ctx.moveTo(plotX, plotY);
                    else ctx.lineTo(plotX, plotY);
                }
                ctx.stroke();
            }

            // ì¶• ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.moveTo(padding, h - padding);
            ctx.lineTo(w - padding, h - padding);
            ctx.strokeStyle = '#333';
            ctx.stroke();
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        rangeN.addEventListener('input', drawDistribution);
        rangeP.addEventListener('input', drawDistribution);

        // ì´ˆê¸° ì‹¤í–‰
        drawDistribution();
        // ì‹œë®¬ë ˆì´ì…˜ìš© ê·¸ë¦¬ë“œì— ì´ˆê¸°ê°’ í‘œì‹œ
        coinGrid.innerHTML = '<div style="color:#888; text-align:center; grid-column:1/-1;">ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!</div>';

        // ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘
        window.addEventListener('resize', drawDistribution);

    </script>

</body>

</html>