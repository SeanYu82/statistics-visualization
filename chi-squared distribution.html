<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ì´ì œê³±ë¶„í¬ ì‹œë®¬ë ˆì´ì…˜</title>

    <!-- (1) Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- (2) MathJax ì„¤ì • : $...$ ë¥¼ ì¸ë¼ì¸ ìˆ˜ì‹ìœ¼ë¡œ ì‚¬ìš© -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>

    <!-- (3) MathJax ë³¸ì²´ ë¡œë“œ -->
    <script id="MathJax-script"
            async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        body { font-family: 'Suit', 'Pretendard', sans-serif; background-color: #f4f4f9; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 800px; width: 100%; }
        h2 { text-align: center; color: #333; margin-bottom: 10px; }
        .description { background: #eef2f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; line-height: 1.6; color: #555; font-size: 0.95rem; }
        .highlight { color: #d63384; font-weight: bold; }
        .controls { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px; background: #fafafa; padding: 15px; border-radius: 8px; border: 1px solid #ddd; }
        label { font-weight: bold; font-size: 1.1rem; }
        input[type=range] { width: 200px; cursor: pointer; }
        button { background-color: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 1rem; transition: background 0.2s; }
        button:hover { background-color: #45a049; }
        .chart-container { position: relative; height: 400px; width: 100%; }
        .formula-box { margin-top: 20px; text-align: center; font-size: 0.9rem; color: #777; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“Š ì¹´ì´ì œê³±ë¶„í¬ ìƒì„± ì›ë¦¬ ì‹œê°í™”</h2>
    
    <div class="description">
        <p><strong>ì¹´ì´ì œê³±ë¶„í¬($\chi^2$)ì˜ ì •ì˜:</strong> í‘œì¤€ì •ê·œë¶„í¬ $N(0,1)$ë¥¼ ë”°ë¥´ëŠ” ì„œë¡œ ë…ë¦½ì¸ ë³€ìˆ˜ë“¤ì„ ì œê³±í•˜ì—¬ ë”í•œ ê°’ì˜ ë¶„í¬ì…ë‹ˆë‹¤.</p>
        <ul>
            <li>í˜„ì¬ ì„¤ì •ëœ ììœ ë„(ë”í•˜ëŠ” ê°œìˆ˜): <span id="displayDf" class="highlight">2</span>ê°œ ($n$)</li>
            <li>ê³¼ì •: $Z_1, \dots, Z_n$ ë½‘ê¸° â†’ ê°ê° ì œê³± ($Z_i^2$) â†’ í•©ê³„ êµ¬í•˜ê¸° ($Y = \sum Z_i^2$)</li>
            <li>ê²°ê³¼: ì•„ë˜ ê·¸ë˜í”„ì—ì„œ <strong>íŒŒë€ ë§‰ëŒ€(ì‹œë®¬ë ˆì´ì…˜)</strong>ê°€ <strong>ë¹¨ê°„ ì„ (ì´ë¡ ì  í™•ë¥ ë°€ë„í•¨ìˆ˜)</strong>ì— ê°€ê¹Œì›Œì§€ëŠ” ê²ƒì„ í™•ì¸í•˜ì„¸ìš”.</li>
        </ul>
    </div>

    <div class="controls">
        <label for="dfRange">ììœ ë„ (n): <span id="dfValue">2</span></label>
        <input type="range" id="dfRange" min="1" max="10" step="1" value="2">
        <button onclick="resetSimulation()">ì´ˆê¸°í™” & ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <div class="chart-container">
        <canvas id="chiChart"></canvas>
    </div>

    <div class="formula-box">
        $\sum_{i=1}^n X_i^2 \sim \chi^2(n)$ <br>
        ììœ ë„(n)ê°€ ì»¤ì§ˆìˆ˜ë¡ ë¶„í¬ê°€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™í•˜ë©° ì¢… ëª¨ì–‘(ì •ê·œë¶„í¬ í˜•íƒœ)ì— ê°€ê¹Œì›Œì§‘ë‹ˆë‹¤.
    </div>
</div>

<script>
    // --- ì„¤ì • ë³€ìˆ˜ ---
    let df = 2; // ììœ ë„ (Degrees of Freedom)
    let simulationSpeed = 100; // í”„ë ˆì„ë‹¹ ìƒì„±í•  ìƒ˜í”Œ ìˆ˜
    let samples = [];
    let animationId;
    let chart;
    const maxVal = 20; // Xì¶• ìµœëŒ€ê°’
    const binSize = 0.5; // íˆìŠ¤í† ê·¸ë¨ êµ¬ê°„ í¬ê¸°
    
    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜: í‘œì¤€ì •ê·œë¶„í¬ ë‚œìˆ˜ ìƒì„± (Box-Muller Transform) ---
    function randn_bm() {
        let u = 0, v = 0;
        while(u === 0) u = Math.random(); 
        while(v === 0) v = Math.random();
        return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
    }

    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜: ê°ë§ˆ í•¨ìˆ˜ ê·¼ì‚¬ (PDF ê³„ì‚°ìš©) ---
    function gamma(n) {
        // ê°„ë‹¨í•œ íŒ©í† ë¦¬ì–¼ ê¸°ë°˜ ê·¼ì‚¬ (ì •ìˆ˜ ë° ë°˜ì •ìˆ˜ ì§€ì›ì„ ìœ„í•œ Lanczos ê·¼ì‚¬ ê°„ì†Œí™”)
        // ì‹œê°í™” ëª©ì ì´ë¯€ë¡œ ì •ë°€ë„ëŠ” ì ë‹¹íˆ íƒ€í˜‘
        const g = 7;
        const p = [0.99999999999980993, 676.5203681218851, -1259.1392167224028, 771.32342877765313, -176.61502916214059, 12.507343278686905, -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7];
        if (n < 0.5) return Math.PI / (Math.sin(Math.PI * n) * gamma(1 - n));
        n -= 1;
        let x = p[0];
        for (let i = 1; i < g + 2; i++) x += p[i] / (n + i);
        let t = n + g + 0.5;
        return Math.sqrt(2 * Math.PI) * Math.pow(t, (n + 0.5)) * Math.exp(-t) * x;
    }

    // --- ì¹´ì´ì œê³±ë¶„í¬ PDF ê³„ì‚° í•¨ìˆ˜ ---
    function chiSquarePDF(x, k) {
        if (x <= 0) return 0;
        const numerator = Math.pow(x, (k / 2) - 1) * Math.exp(-x / 2);
        const denominator = Math.pow(2, k / 2) * gamma(k / 2);
        return numerator / denominator;
    }

    // --- ì°¨íŠ¸ ì´ˆê¸°í™” ---
    function initChart() {
        const ctx = document.getElementById('chiChart').getContext('2d');
        
        // Xì¶• ë¼ë²¨ ìƒì„±
        const labels = [];
        for (let i = 0; i <= maxVal; i += binSize) {
            labels.push(i.toFixed(1));
        }

        chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'ì´ë¡ ì  ë¶„í¬ (PDF)',
                        data: [],
                        type: 'line',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: false,
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ (Histogram)',
                        data: [],
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1,
                        barPercentage: 1.0,
                        categoryPercentage: 1.0,
                        yAxisID: 'y'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                scales: {
                    x: { title: { display: true, text: 'ê°’ (Random Variable Value)' } },
                    y: { title: { display: true, text: 'í™•ë¥  ë°€ë„ (Density)' }, beginAtZero: true, max: 0.6 } // Yì¶• ê³ ì •
                },
                animation: false // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì°¨íŠ¸ ìì²´ ì• ë‹ˆë©”ì´ì…˜ ë”
            }
        });
    }

    // --- ì´ë¡ ì  PDF ë¼ì¸ ì—…ë°ì´íŠ¸ ---
    function updateTheoreticalLine() {
        const theoreticalData = [];
        for (let i = 0; i <= maxVal; i += binSize) {
            // êµ¬ê°„ì˜ ì¤‘ê°„ê°’(midpoint)ì„ ì‚¬ìš©í•˜ì—¬ PDF ê³„ì‚°
            theoreticalData.push(chiSquarePDF(i + binSize/2, df));
        }
        chart.data.datasets[0].data = theoreticalData;
        
        // ììœ ë„ì— ë”°ë¼ Yì¶• ìŠ¤ì¼€ì¼ ì¡°ì • (ììœ ë„ 1ì¼ ë•Œ ê°’ì´ ë§¤ìš° ì»¤ì§€ë¯€ë¡œ)
        if (df === 1) chart.options.scales.y.max = 1.0;
        else if (df === 2) chart.options.scales.y.max = 0.6;
        else chart.options.scales.y.max = 0.4;
    }

    // --- ì‹œë®¬ë ˆì´ì…˜ ë£¨í”„ ---
    function runSimulation() {
        // í•œ ë²ˆì— simulationSpeed ë§Œí¼ì˜ ìƒ˜í”Œì„ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
        for (let j = 0; j < simulationSpeed; j++) {
            let sumSq = 0;
            // ììœ ë„(df) ê°œìˆ˜ë§Œí¼ í‘œì¤€ì •ê·œë¶„í¬ì—ì„œ ë½‘ì•„ì„œ ì œê³±í•© ê³„ì‚°
            for (let i = 0; i < df; i++) {
                let z = randn_bm();
                sumSq += z * z;
            }
            samples.push(sumSq);
        }

        // íˆìŠ¤í† ê·¸ë¨ ë°ì´í„° ê³„ì‚°
        const bins = new Array(Math.ceil(maxVal / binSize) + 1).fill(0);
        let count = 0;
        
        for (let val of samples) {
            if (val < maxVal) {
                const binIndex = Math.floor(val / binSize);
                bins[binIndex]++;
                count++;
            }
        }

        // ë¹ˆë„ìˆ˜ë¥¼ í™•ë¥ ë°€ë„(Density)ë¡œ ë³€í™˜: (ë¹ˆë„ / ì´ê°œìˆ˜) / êµ¬ê°„ë„ˆë¹„
        const densityData = bins.map(b => (b / count) / binSize);

        chart.data.datasets[1].data = densityData;
        chart.update('none'); // ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ì¦‰ì‹œ ë Œë”ë§

        animationId = requestAnimationFrame(runSimulation);
    }

    // --- ì œì–´ í•¨ìˆ˜ ---
    function resetSimulation() {
        cancelAnimationFrame(animationId);
        samples = [];
        updateTheoreticalLine();
        chart.update();
        runSimulation();
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    const slider = document.getElementById('dfRange');
    const dfLabel = document.getElementById('dfValue');
    const dfDisplay = document.getElementById('displayDf');

    slider.addEventListener('input', function() {
        df = parseInt(this.value);
        dfLabel.textContent = df;
        dfDisplay.textContent = df;
        resetSimulation();
    });

    // --- ì´ˆê¸° ì‹¤í–‰ ---
    initChart();
    resetSimulation();

</script>

</body>
</html>